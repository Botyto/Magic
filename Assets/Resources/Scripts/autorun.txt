setmetatable(_G, nil)
if FirstLoad == nil then
	FirstLoad = true
end
local wasFirst = FirstLoad

--Load library files
Script.DoFile("Scripts/lib/lib")
Script.DoFile("Scripts/lib/core")
Script.DoFile("Scripts/lib/class")
Script.DoFile("Scripts/lib/Object")

--Load source code
Script.DoFolder("Script/", function(filename)
	return not string.ends_with(filename, "autorun")
end)

if __ADDITIONAL_CODE then
	Script.DoString(__ADDITIONAL_CODE)
end

FirstLoad = false
local _G_meta = {
	__index = function(t, key)
		errorf("Undefined global '%s'", tostring(key))
	end,
	__newindex = function(t, key, value)
		errorf("Assigning undefined global '%s'", tostring(key))
	end,
}
if config.autoLookupObject then
	_G_meta.__index = function(t, key)
		local go = GO(key)
		if go then
			return go
		end
		errorf("Undefined global '%s'", tostring(key))
	end
end

setmetatable(_G, _G_meta)

--Prepare for execution
BuildClasses()

RaiseEvent("Start", wasFirst)
